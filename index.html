<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Italian Game Master Trainer</title>
<link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}.container{max-width:1400px;margin:0 auto;background:#fff;border-radius:20px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,.3)}h1{text-align:center;color:#333;margin-bottom:10px;font-size:2.5em}.subtitle{text-align:center;color:#666;margin-bottom:30px;font-size:1.1em}.main-content{display:grid;grid-template-columns:500px 1fr;gap:30px;margin-bottom:30px}.board-container{display:flex;flex-direction:column;align-items:center}#myBoard{width:500px;margin-bottom:20px}.hint-from{box-shadow:inset 0 0 0 5px rgba(255,193,7,.9)!important;background-color:rgba(255,193,7,.4)!important}.hint-to{box-shadow:inset 0 0 0 5px rgba(40,167,69,.9)!important;background-color:rgba(40,167,69,.4)!important}.selected-piece{box-shadow:inset 0 0 0 5px rgba(0,123,255,.8)!important;background-color:rgba(0,123,255,.2)!important}.variation-info{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);padding:20px;border-radius:12px;margin-top:15px;border-left:5px solid #667eea;box-shadow:0 3px 10px rgba(0,0,0,.1)}.variation-info h4{color:#667eea;margin-bottom:10px;font-size:1.1em}.variation-info p{color:#555;line-height:1.6;font-size:.95em}.info-panel{background:#f8f9fa;padding:25px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.1);max-height:800px;overflow-y:auto}.mode-selector{display:flex;gap:10px;margin-bottom:25px;flex-wrap:wrap}.mode-btn{flex:1;padding:12px 20px;border:2px solid #667eea;background:#fff;color:#667eea;border-radius:8px;cursor:pointer;font-weight:700;transition:all .3s;min-width:120px}.mode-btn:hover{background:#667eea;color:#fff;transform:translateY(-2px)}.mode-btn.active{background:#667eea;color:#fff}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px}.stat-card{background:#fff;padding:15px;border-radius:10px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.1)}.stat-label{color:#666;font-size:.9em;margin-bottom:5px}.stat-value{color:#667eea;font-size:1.8em;font-weight:700}.move-history{background:#fff;padding:20px;border-radius:10px;max-height:180px;overflow-y:auto;margin-bottom:20px}.move-history h3{color:#333;margin-bottom:15px}.hint-box{background:#fff3cd;border-left:4px solid #ffc107;padding:15px;border-radius:8px;margin-bottom:20px;display:none}.hint-box.show{display:block}.feedback{padding:15px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:700;display:none}.feedback.correct{background:#d4edda;color:#155724;border:2px solid #28a745;display:block}.feedback.wrong{background:#f8d7da;color:#721c24;border:2px solid #dc3545;display:block}.controls{display:flex;gap:10px;flex-wrap:wrap}.btn{flex:1;padding:12px 25px;border:none;border-radius:8px;cursor:pointer;font-weight:700;transition:all .3s;min-width:100px}.btn-primary{background:#28a745;color:#fff}.btn-primary:hover{background:#218838;transform:translateY(-2px)}.btn-secondary{background:#6c757d;color:#fff}.btn-secondary:hover{background:#5a6268;transform:translateY(-2px)}.btn-hint{background:#ffc107;color:#333}.btn-hint:hover{background:#e0a800;transform:translateY(-2px)}.btn-danger{background:#dc3545;color:#fff}.btn-danger:hover{background:#c82333;transform:translateY(-2px)}.variation-list{background:#fff;padding:20px;border-radius:10px}.variation-list h3{color:#333;margin-bottom:15px}.category-title{color:#667eea;font-weight:700;margin-top:15px;margin-bottom:10px;padding:5px 0;border-bottom:2px solid #667eea}.variation-item{padding:12px;margin-bottom:8px;background:#f8f9fa;border-radius:5px;cursor:pointer;transition:all .3s;border-left:4px solid transparent}.variation-item:hover{background:#e9ecef;transform:translateX(5px);border-left-color:#667eea}.variation-item.active{background:#e7f3ff;border-left-color:#007bff}.variation-item strong{display:block;color:#333;margin-bottom:5px}.variation-item small{color:#666;font-size:.85em}.difficulty{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.75em;margin-left:8px}.difficulty.beginner{background:#d4edda;color:#155724}.difficulty.intermediate{background:#fff3cd;color:#856404}.difficulty.advanced{background:#f8d7da;color:#721c24}.checkmate-badge{background:#ff4444;color:#fff;padding:3px 6px;border-radius:3px;font-size:.7em;margin-left:5px;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.search-box{margin-bottom:20px}.search-box input{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1em}.search-box input:focus{outline:0;border-color:#667eea}@media (max-width:1200px){.main-content{grid-template-columns:1fr}#myBoard{width:100%;max-width:500px}}</style>
</head>
<body>
<div class="container">
<h1>‚ôüÔ∏è Italian Game Master Trainer</h1>
<p class="subtitle">Kuasai pembukaan Italian Game hingga Checkmate! üéØ</p>
<div class="mode-selector">
<button class="mode-btn active" onclick="setMode('learn')">üìö Learn</button>
<button class="mode-btn" onclick="setMode('practice')">üí™ Practice</button>
<button class="mode-btn" onclick="setMode('drill')">‚ö° Drill</button>
</div>
<div class="main-content">
<div class="board-container">
<div id="myBoard"></div>
<div class="controls">
<button class="btn btn-secondary" onclick="resetGame()">üîÑ Reset</button>
<button class="btn btn-danger" onclick="undoMove()">‚Ü©Ô∏è Undo</button>
<button class="btn btn-hint" onclick="showHint()">üí° Hint</button>
<button class="btn btn-primary" onclick="nextExercise()">‚ñ∂Ô∏è Next</button>
</div>
<div class="variation-info" id="variationInfo">
<h4>üìñ Tentang Variasi Ini</h4>
<p id="variationHistory">Memuat...</p>
</div>
</div>
<div class="info-panel">
<div class="stats">
<div class="stat-card"><div class="stat-label">Benar</div><div class="stat-value" id="correct">0</div></div>
<div class="stat-card"><div class="stat-label">Salah</div><div class="stat-value" id="wrong">0</div></div>
<div class="stat-card"><div class="stat-label">Akurasi</div><div class="stat-value" id="accuracy">0%</div></div>
</div>
<div class="feedback" id="feedback"></div>
<div class="hint-box" id="hintBox"><strong>üí° Hint:</strong> <span id="hintText"></span></div>
<div class="move-history"><h3>üìú Riwayat Gerakan</h3><div id="moveList"></div></div>
<div class="variation-list">
<h3>üéØ Italian Game Variations</h3>
<div class="search-box"><input type="text" id="searchInput" placeholder="üîç Cari variasi..." onkeyup="filterVariations()"></div>
<div id="variationsList"></div>
</div>
</div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script>
let board,game,currentMode='learn',stats={correct:0,wrong:0},currentVariation='legal-trap',selectedSquare=null,moveHistory=[],currentMoveIndex=0;

// Data compressed - lazy load
const varData={
'legal-trap':{n:'Legal Trap',d:'beginner',cm:true,h:'Legal Trap jebakan klasik dinamai Sire de Legal (1702-1792). Mengeksploitasi keserakahan lawan yang ambil queen, berakhir checkmate paksa.',m:['e4','e5','Nf3','d6','Bc4','Bg4','Nc3','g6','Nxe5','Bxd1','Bxf7+','Ke7','Nd5#'],ht:['e4: pusat','e5: simetris','Nf3: kembangkan','d6: pasif','Bc4: Italian','Bg4: pin keliru','Nc3: jebakan','g6: lemah f7','Nxe5: korban queen!','Bxd1: rakus','Bxf7+: check raja','Ke7: paksa tengah','Nd5#: CHECKMATE!'],e:['e4 kontrol pusat','e5 simetris','Nf3 natural','d6 pasif','Bc4 target f7','Bg4 keliru','Nc3 jebakan','g6 fatal','Nxe5 brilian','Bxd1 tertipu','Bxf7+ paksa','Ke7 tengah','Nd5# MATE!']},
'scholars-mate':{n:"Scholar's Mate",d:'beginner',cm:true,h:"Scholar's Mate checkmate tercepat untuk pemula, menyerang f7 dengan queen dan bishop.",m:['e4','e5','Bc4','Nc6','Qh5','Nf6','Qxf7#'],ht:['e4: pusat','e5: respons','Bc4: target f7','Nc6: develop','Qh5: agresif','Nf6: terlambat','Qxf7#: MATE!'],e:['e4 pusat','e5 simetris','Bc4 target f7','Nc6 develop','Qh5 ancam','Nf6 terlambat','Qxf7# MATE!']},
'fried-liver-mate':{n:'Fried Liver Mate',d:'advanced',cm:true,h:'Fried Liver Attack dengan checkmate jika hitam salah bertahan.',m:['e4','e5','Nf3','Nc6','Bc4','Nf6','Ng5','d5','exd5','Nxd5','Nxf7','Kxf7','Qf3+','Ke6','Nc3','Nb4','Qe4','c6','a3','Na6','d4','Nc7','Bf4','Nf6','Qe5#'],ht:['e4: pusat','e5: respons','Nf3: develop','Nc6: defend','Bc4: Italian','Nf6: Two Knights','Ng5: f7!','d5: counter','exd5: ambil','Nxd5: recapture','Nxf7: Fried Liver!','Kxf7: paksa','Qf3+: check','Ke6: tengah','Nc3: develop','Nb4: active','Qe4: pressure','c6: solid','a3: kick','Na6: retreat','d4: center','Nc7: pasif','Bf4: develop','Nf6: blok','Qe5#: MATE!'],e:['e4 pusat','e5 simetris','Nf3 develop','Nc6 defend','Bc4 Italian','Nf6 Two Knights','Ng5 f7','d5 counter','exd5 ambil','Nxd5 ambil','Nxf7 sacrifice','Kxf7 paksa','Qf3+ check','Ke6 bahaya','Nc3 develop','Nb4 keluar','Qe4 pressure','c6 bertahan','a3 paksa','Na6 pasif','d4 dominasi','Nc7 terpojok','Bf4 coordinate','Nf6 blok','Qe5# MATE!']},
'blackburne-shilling-mate':{n:'Blackburne Shilling',d:'advanced',cm:true,h:'Blackburne Shilling jebakan mematikan untuk putih yang rakus.',m:['e4','e5','Nf3','Nc6','Bc4','Nd4','Nxe5','Qg5','Nxf7','Qxg2','Rf1','Qxe4+','Be2','Nf3#'],ht:['e4: pusat','e5: respons','Nf3: develop','Nc6: defend','Bc4: Italian','Nd4: jebakan!','Nxe5: rakus','Qg5: double','Nxf7: makin rakus','Qxg2: masuk','Rf1: defend','Qxe4+: check','Be2: blok','Nf3#: DOUBLE MATE!'],e:['e4 pusat','e5 simetris','Nf3 develop','Nc6 defend','Bc4 Italian','Nd4 jebakan','Nxe5 fatal','Qg5 double attack','Nxf7 rakus','Qxg2 dominan','Rf1 desperate','Qxe4+ check','Be2 paksa','Nf3# DOUBLE MATE!']},
'traxler-mate':{n:'Traxler Counter',d:'advanced',cm:true,h:'Traxler counter-attack spektakuler dengan checkmate pattern.',m:['e4','e5','Nf3','Nc6','Bc4','Nf6','Ng5','Bc5','Nxf7','Bxf2+','Kf1','Qe7','Nxh8','d5','exd5','Nd4','d6','Bg4','Qe1','Bf3','gxf3','Nf3+','Kg2','Nxe1+','Kh3','Qh4#'],ht:['e4: pusat','e5: respons','Nf3: develop','Nc6: defend','Bc4: Italian','Nf6: Two Knights','Ng5: f7','Bc5: Traxler!','Nxf7: ambil','Bxf2+: counter!','Kf1: paksa','Qe7: threat','Nxh8: exchange','d5: attack','exd5: ambil','Nd4: centralize','d6: push','Bg4: pin','Qe1: defend','Bf3: powerful','gxf3: paksa','Nf3+: discovered','Kg2: paksa','Nxe1+: check','Kh3: escape','Qh4#: MATE!'],e:['e4 pusat','e5 simetris','Nf3 develop','Nc6 defend','Bc4 Italian','Nf6 Two Knights','Ng5 f7','Bc5 Traxler','Nxf7 ambil','Bxf2+ counter','Kf1 paksa','Qe7 threat','Nxh8 rook','d5 attack','exd5 ambil','Nd4 strong','d6 push','Bg4 pin','Qe1 defend','Bf3 deadly','gxf3 paksa','Nf3+ check','Kg2 paksa','Nxe1+ check','Kh3 escape','Qh4# MATE!']},
'back-rank-mate':{n:'Back Rank Mate',d:'beginner',cm:true,h:'Back Rank Mate pola checkmate paling umum, raja terperangkap di back rank.',m:['e4','e5','Nf3','Nc6','Bc4','Bc5','O-O','Nf6','d3','d6','Bg5','h6','Bh4','g5','Bg3','Nh5','Nxg5','hxg5','Qxh5','Qe7','Qh8+','Kd7','Qxa8','Nd4','Qxb7','Nxc2','Rc1','Nxa1','Qxc7+','Ke8','Qc8+','Qd8','Qxd8#'],ht:['e4: pusat','e5: respons','Nf3: develop','Nc6: defend','Bc4: Italian','Bc5: Piano','O-O: castle','Nf6: develop','d3: solid','d6: reinforce','Bg5: pin','h6: kick','Bh4: retreat','g5: chase','Bg3: safe','Nh5: attack','Nxg5: sacrifice','hxg5: ambil','Qxh5: queen in','Qe7: defend','Qh8+: check','Kd7: walks','Qxa8: rook','Nd4: attack','Qxb7: pawn','Nxc2: rook','Rc1: attack','Nxa1: take','Qxc7+: check','Ke8: back','Qc8+: check','Qd8: blok','Qxd8#: BACK RANK MATE!'],e:['e4 pusat','e5 simetris','Nf3 develop','Nc6 defend','Bc4 Italian','Bc5 Piano','O-O castle','Nf6 develop','d3 solid','d6 reinforce','Bg5 pin','h6 force','Bh4 retreat','g5 chase','Bg3 safe','Nh5 attack','Nxg5 sacrifice','hxg5 ambil','Qxh5 infiltrate','Qe7 defend','Qh8+ check','Kd7 danger','Qxa8 rook','Nd4 attack','Qxb7 pawn','Nxc2 rook','Rc1 attack','Nxa1 take','Qxc7+ check','Ke8 back rank','Qc8+ check','Qd8 blok','Qxd8# MATE!']},
'arabian-mate':{n:'Arabian Mate',d:'beginner',cm:true,h:'Arabian Mate pattern klasik rook dan knight bekerja sama mating raja di corner.',m:['e4','e5','Nf3','Nc6','Bc4','Bc5','c3','Nf6','d4','exd4','cxd4','Bb4+','Bd2','Bxd2+','Nbxd2','O-O','O-O','d6','e5','dxe5','dxe5','Nxe5','Nxe5','Re8','Ng5','Re1','Rxe1+','Qxe1','h6','Nf3','Bg4','Qe3','Qd6','Rae1','Rae8','Qd4','Rxe1+','Nxe1','Qe6','Nf3','Bxf3','gxf3','Qe1+','Kg2','Qxf2+','Kh3','Qxf3+','Kh4','g5+','Kh5','Kg7','Qd7','Qf5','Qxc7','Qf4','Qc3','Ne5','Qxa7','Nf3','Qa3','Qh2#'],ht:['e4: pusat','e5: respons','Nf3: develop','Nc6: defend','Bc4: Italian','Bc5: Piano','c3: prepare d4','Nf6: develop','d4: center','exd4: take','cxd4: recapture','Bb4+: check','Bd2: blok','Bxd2+: trade','Nbxd2: recapture','O-O: castle','O-O: castle','d6: solid','e5: push','dxe5: take','dxe5: recapture','Nxe5: trade','Nxe5: take','Re8: pin','Ng5: attack','Re1: defend','Rxe1+: trade','Qxe1: recapture','h6: kick','Nf3: retreat','Bg4: pin','Qe3: develop','Qd6: centralize','Rae1: activate','Rae8: double','Qd4: centralize','Rxe1+: trade','Nxe1: take','Qe6: active','Nf3: develop','Bxf3: trade','gxf3: recapture','Qe1+: check','Kg2: escape','Qxf2+: check','Kh3: escape','Qxf3+: check','Kh4: hunted','g5+: check','Kh5: corner','Kg7: king active','Qd7: active','Qf5: attack','Qxc7: pawn','Qf4: attack','Qc3: defend','Ne5: blok','Qxa7: pawn','Nf3: attack','Qa3: defend','Qh2#: ARABIAN MATE!'],e:['Continuation to Arabian mate pattern - rook and knight coordinate in corner']},
'smothered-mate':{n:'Smothered Mate',d:'intermediate',cm:true,h:'Smothered Mate klasik Philidor - knight mencekik raja yang terblokir pieces sendiri.',m:['e4','e5','Nf3','Nc6','Bc4','Bc5','O-O','Nf6','d3','d6','Bg5','h6','Bh4','g5','Bg3','Nh5','Nxg5','hxg5','Qxh5','Qf6','Qh8+','Ke7','Qxh7','Nd4','Qh4','Nxc2','Qxg5','Nxa1','Bh4','Be6','Nc3','Kd7','Nd5','Bxd5','exd5','Qxg5','Bxg5+','Kc8','Bf7','Nc2','Rxa1','Ne3','Bxe3','fxe3','b6','Rf1','Kb7','Rf7','Rc8','Rxf8#'],ht:['Continuation to back rank smothered mate','Rf8#: SMOTHERED MATE!'],e:['Position leads to smothered mate pattern']},
'anastasias-mate':{n:"Anastasia's Mate",d:'intermediate',cm:true,h:"Anastasia's Mate pattern - knight dan rook bekerja sama mengurung raja di sisi papan.",m:['e4','e5','Nf3','Nc6','Bc4','Nf6','Ng5','d5','exd5','Nxd5','Nxf7','Kxf7','Qf3+','Ke6','Nc3','Nb4','Qe4','c6','a3','Na6','d4','exd4','Qxd4','Nc5','Bf4','Bd6','O-O-O','Rf8','Rhe1+','Kf7','Qd2','Kg8','Bxd6','Qxd6','Qg5','Qf6','Qxf6','gxf6','Nd5','cxd5','Bxd5+','Kh8','Re8','Ne6','Rxf8#'],ht:['Continuation leads to Anastasia mate','Rxf8#: ANASTASIA MATE!'],e:['Rook and knight coordinate perfectly']},
'boden-mate':{n:"Boden's Mate",d:'intermediate',cm:true,h:"Boden's Mate - dua bishop diagonal bersilangan mencekik raja.",m:['e4','e5','Nf3','Nc6','Bc4','Nf6','Nc3','Bc5','O-O','O-O','d3','d6','Bg5','Be6','Nd5','Bxd5','exd5','Nd4','Nxd4','Bxd4','Bxd4','exd4','c3','dxc3','bxc3','h6','Bh4','g5','Bg3','Nh5','Qf3','Nxg3','hxg3','Qf6','Qxf6','Kg7','Rae1','Rae8','Re7','Rxe7','Qxe7','Re8','Qxe8','Kf6','Qe6+','Kg7','Qe7','Kh8','Qxf7','c6','dxc6','bxc6','Qxc6','a5','Qxa8+','Kg7','Qa7+','Kf6','Qb6','Ke5','Bf7','Kf5','Qd4','Kg5','Qe4','Kh5','Qf5','Kh4','Qg4#'],ht:['Extended to Bodens Mate pattern','Qg4#: BODEN MATE!'],e:['Two bishops crossing diagonals trap king']},
'giuoco-piano-endgame':{n:'Giuoco Piano Endgame',d:'beginner',cm:false,h:'Giuoco Piano transisi ke endgame instructive untuk belajar teknik dasar.',m:['e4','e5','Nf3','Nc6','Bc4','Bc5','c3','Nf6','d3','d6','O-O','O-O','Bg5','h6','Bh4','Be6','Nbd2','Qe7','Re1','Rae8','Nf1','g5','Bg3','Nh5','Bb3','Nxg3','hxg3','Bxb3','Qxb3','Qe6','Qxe6','Rxe6','Ng5','Re7','Ne3','Kg7','Nf5+','Kf6','Nxe7','Nxe7','Kf1','Rg8','Ke2','h5','f3','h4','gxh4','gxh4','Rh1','Rh8','Rxh4','Rxh4','Nxh4','Ng6','Nxg6','Kxg6'],ht:['Continuation to drawn endgame','Position reaches theoretical draw'],e:['Equal endgame with drawing technique']},
'two-knights-endgame':{n:'Two Knights Endgame',d:'intermediate',cm:false,h:'Two Knights Defense ke endgame seimbang - belajar piece activity.',m:['e4','e5','Nf3','Nc6','Bc4','Nf6','d3','Be7','O-O','O-O','Re1','d6','c3','Na5','Bb3','Nxb3','axb3','c6','Nbd2','Bg4','h3','Bh5','Nf1','Re8','Ng3','Bg6','d4','exd4','cxd4','Bf8','Bf4','Nd7','Qd2','Nb6','Rac1','Rc8','Nh4','Be4','f3','Bd5','Nhf5','Na8','Rc3','Nc7','Rec1','Ne6','Bxd6','Bxd6','Nxd6','Rcd8','Nf5','Nxd4','Nxd4','Rxd4','Qe3','Rxd1+','Rxd1','Re5','Rd8+','Kh7','Ne2','Bb7','Nf4','g6','Qd4','Rxe4','fxe4','Bxe4','Nxe4','Qxe4+','Kh2','Qxb3','Qxa7','Qxb2'],ht:['Continuation to balanced endgame','Material equal position'],e:['Balanced endgame technique']},
'hungarian-endgame':{n:'Hungarian Endgame',d:'beginner',cm:false,h:'Hungarian Defense ke endgame solid untuk pemula belajar teknik dasar.',m:['e4','e5','Nf3','Nc6','Bc4','Be7','d4','exd4','Nxd4','Nf6','Nc3','O-O','O-O','d6','Be3','Bd7','f4','Nxd4','Bxd4','Bc6','Qe2','Re8','Rad1','Bf8','Bb3','a6','Kh1','Qe7','Qf3','Qe6','Rfe1','Rad8','Bc4','Qe7','Bb3','Re6','Nd5','Bxd5','Bxd5','Nxd5','exd5','Qe8','c4','Qd7','Bc3','Re2','Qg3','Rxb2','Bxb2','Qxa4','Bc3','Qa2','Re2','Qa3','Qf3','Qc5','R1e1','b5','cxb5','axb5','R2e3','b4','Bd4','Qc4','Qg3','c5','dxc6','Qxc6','Rc1','Qb7','Qe5','Qd7','Bb6','Rd6','Rxc6','Qd1+','Kg2','Qxc6','Qxd6','Qc2+','Kh3','Qxe3+','Qxe3','f6'],ht:['Continuation to instructive endgame','Equal chances'],e:['Endgame learning position']},
'evans-accepted-endgame':{n:'Evans Gambit Endgame',d:'advanced',cm:false,h:'Evans Gambit accepted transformasi kompensasi ke aktivitas superior di endgame.',m:['e4','e5','Nf3','Nc6','Bc4','Bc5','b4','Bxb4','c3','Ba5','d4','exd4','O-O','dxc3','Qb3','Qe7','Nxc3','Nf6','Nd5','Nxd5','exd5','Ne5','Nxe5','Qxe5','Bf4','Qe7','Rfe1','d6','Rac1','Bb6','Rc3','O-O','Rce3','Qd8','Bxd6','cxd6','Rxe7','Re8','Rxe8+','Qxe8','Qxf7+','Qxf7','Bxf7+','Kxf7','Rxe8','Kxe8','Kf1','Kd7','Ke2','Bd4','Kd3','Bb2','Kc4','Bd4','f4','Bb6','Kb5','Bd8','Kc4','Bc7','g4','Bb6','h4','Bd8','g5','Bc7','Kd4','Bb6+','Ke4','Bc7','h5','Bb8','Kf5','Bc7','g6','hxg6','hxg6','Bb8','Ke6','Bc7','f5','Bb6','Kf7','Bd8','Kxg7','Ke7','f6+','Kd7','f7','Ke7','f8=Q+','Kxf8','Kf6','Ke8','Ke6','Kf8','Kxd6','Kf7','Kc6','Kxg6','d6','Bxd6','Kxd6'],ht:['Complex endgame with pawn promotion','Theoretical draw'],e:['Endgame technique with passed pawns']}
};

const varList=[
{k:'legal-trap',n:'Legal Trap ‚ôî',d:'beginner',c:'Famous Checkmates'},
{k:'scholars-mate',n:"Scholar's Mate ‚ôî",d:'beginner',c:'Famous Checkmates'},
{k:'back-rank-mate',n:'Back Rank Mate ‚ôî',d:'beginner',c:'Famous Checkmates'},
{k:'arabian-mate',n:'Arabian Mate ‚ôî',d:'beginner',c:'Famous Checkmates'},
{k:'smothered-mate',n:'Smothered Mate ‚ôî',d:'intermediate',c:'Famous Checkmates'},
{k:'anastasias-mate',n:"Anastasia's Mate ‚ôî",d:'intermediate',c:'Famous Checkmates'},
{k:'boden-mate',n:"Boden's Mate ‚ôî",d:'intermediate',c:'Famous Checkmates'},
{k:'fried-liver-mate',n:'Fried Liver Mate ‚ôî',d:'advanced',c:'Italian Checkmates'},
{k:'blackburne-shilling-mate',n:'Blackburne Shilling ‚ôî',d:'advanced',c:'Italian Checkmates'},
{k:'traxler-mate',n:'Traxler Counter ‚ôî',d:'advanced',c:'Italian Checkmates'},
{k:'giuoco-piano-endgame',n:'Giuoco Piano Endgame',d:'beginner',c:'Endgame Learning'},
{k:'evans-accepted-endgame',n:'Evans Gambit Endgame',d:'advanced',c:'Endgame Learning'},
{k:'two-knights-endgame',n:'Two Knights Endgame',d:'intermediate',c:'Endgame Learning'},
{k:'hungarian-endgame',n:'Hungarian Endgame',d:'beginner',c:'Endgame Learning'}
];

function renderVarList(){let h='',cur='';varList.forEach(v=>{if(v.c!==cur){h+=`<div class="category-title">${v.c}</div>`;cur=v.c}let cm=varData[v.k].cm?' <span class="checkmate-badge">‚ôî MATE</span>':'';h+=`<div class="variation-item ${v.k===currentVariation?'active':''}" onclick="loadVariation('${v.k}')"><strong>${v.n}${cm}</strong><small><span class="difficulty ${v.d}">${v.d}</span> | ${varData[v.k].m.length} moves</small></div>`});document.getElementById('variationsList').innerHTML=h}

function loadVariation(k){currentVariation=k;game=new Chess();moveHistory=[];currentMoveIndex=0;selectedSquare=null;board.position('start');document.getElementById('variationHistory').textContent=varData[k].h;document.querySelectorAll('.hint-from,.hint-to').forEach(el=>el.classList.remove('hint-from','hint-to'));document.getElementById('hintBox').classList.remove('show');document.getElementById('feedback').style.display='none';updateMoveList();renderVarList()}

function setMode(m){currentMode=m;document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');resetGame()}

function resetGame(){loadVariation(currentVariation)}

function nextExercise(){let keys=Object.keys(varData),idx=keys.indexOf(currentVariation);idx=(idx+1)%keys.length;loadVariation(keys[idx])}

function undoMove(){if(moveHistory.length>0){moveHistory.pop();currentMoveIndex=Math.max(0,currentMoveIndex-2);game=new Chess();moveHistory.forEach(m=>game.move(m));board.position(game.fen());updateMoveList();document.getElementById('feedback').style.display='none';document.querySelectorAll('.hint-from,.hint-to').forEach(el=>el.classList.remove('hint-from','hint-to'))}}

function showHint(){let v=varData[currentVariation];if(currentMoveIndex>=v.m.length){alert('Variasi selesai!');return}let mv=v.m[currentMoveIndex],h=v.ht[currentMoveIndex];document.getElementById('hintText').textContent=h;document.getElementById('hintBox').classList.add('show');document.querySelectorAll('.hint-from,.hint-to').forEach(el=>el.classList.remove('hint-from','hint-to'));if(currentMode==='learn'){setTimeout(()=>{let m=game.move(mv,{sloppy:true});if(m){let from=document.querySelector(`[data-square="${m.from}"]`),to=document.querySelector(`[data-square="${m.to}"]`);if(from)from.classList.add('hint-from');if(to)to.classList.add('hint-to')}},100)}}

function updateMoveList(){let v=varData[currentVariation],h='';moveHistory.forEach((m,i)=>{if(i%2===0)h+=`<strong>${Math.floor(i/2)+1}.</strong> `;h+=`${m} `});document.getElementById('moveList').innerHTML=h||'Belum ada gerakan'}

function updateStats(){document.getElementById('correct').textContent=stats.correct;document.getElementById('wrong').textContent=stats.wrong;let t=stats.correct+stats.wrong,acc=t>0?Math.round(stats.correct/t*100):0;document.getElementById('accuracy').textContent=acc+'%'}

function onDragStart(s,p){if(game.game_over())return false;if(currentMode==='learn'&&game.turn()!==p[0])return false;return true}

function onDrop(src,tgt){selectedSquare=null;document.querySelectorAll('.selected-piece').forEach(el=>el.classList.remove('selected-piece'));let v=varData[currentVariation];if(currentMoveIndex>=v.m.length)return'snapback';let expected=v.m[currentMoveIndex],move=game.move({from:src,to:tgt,promotion:'q'});if(!move)return'snapback';let moveStr=move.from+move.to+(move.promotion?move.promotion:'');if(currentMode==='practice'||currentMode==='drill'){if(moveStr===expected||move.san===expected||move.from+move.to===expected){moveHistory.push(move.san);currentMoveIndex++;document.getElementById('feedback').className='feedback correct';document.getElementById('feedback').textContent='‚úì Benar! '+v.e[currentMoveIndex-1];stats.correct++;updateStats();setTimeout(()=>{if(currentMoveIndex<v.m.length){let nextMove=game.move(v.m[currentMoveIndex],{sloppy:true});if(nextMove){moveHistory.push(nextMove.san);currentMoveIndex++;board.position(game.fen());updateMoveList()}}if(currentMoveIndex>=v.m.length){setTimeout(()=>{alert(v.cm?'üéâ CHECKMATE! Variasi selesai!':'‚úÖ Variasi selesai! Klik Next untuk lanjut.');},300)}},500)}else{game.undo();document.getElementById('feedback').className='feedback wrong';document.getElementById('feedback').textContent='‚úó Salah! Coba lagi atau klik Hint.';stats.wrong++;updateStats();return'snapback'}}else{moveHistory.push(move.san);currentMoveIndex++;updateMoveList();if(currentMoveIndex<v.m.length){setTimeout(()=>{let nextMove=game.move(v.m[currentMoveIndex],{sloppy:true});if(nextMove){moveHistory.push(nextMove.san);currentMoveIndex++;board.position(game.fen());updateMoveList()}},300)}}updateMoveList();document.getElementById('hintBox').classList.remove('show');document.querySelectorAll('.hint-from,.hint-to').forEach(el=>el.classList.remove('hint-from','hint-to'))}

function onSnapEnd(){board.position(game.fen())}

function filterVariations(){let q=document.getElementById('searchInput').value.toLowerCase(),items=document.querySelectorAll('.variation-item');items.forEach(el=>{let txt=el.textContent.toLowerCase();el.style.display=txt.includes(q)?'block':'none'})}

// Initialize
document.addEventListener('DOMContentLoaded',()=>{game=new Chess();let cfg={draggable:true,position:'start',onDragStart:onDragStart,onDrop:onDrop,onSnapEnd:onSnapEnd,pieceTheme:'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'};board=Chessboard('myBoard',cfg);renderVarList();loadVariation('legal-trap');updateStats()});
</script>
</body>
</html>
